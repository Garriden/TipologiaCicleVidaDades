---
title: "TipologiaDades-Practica2"
author: "Silvia Benet, Marc Garrido"
date: "15/5/2020"
output:
  pdf_document:
    highlight: zenburn
    toc: yes
  word_document: default
  html_document:
    highlight: default
    number_sections: no
    theme: cosmo
    toc: yes
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

******
******

# 1. Descripció del Dataset.

https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009

```{r }

library(ggplot2)
library(dplyr)

wineQualityRed <- read.csv('winequality-red.csv', stringsAsFactors = FALSE, header = TRUE, sep=";")

names(wineQualityRed) <- c("fixedacidity",
   "volatileacidity",
   "citricacid",
   "residualsugar",
   "chlorides",
   "freesulfurdioxide",
   "totalsulfurdioxide",
   "density",
   "pH",
   "sulphates",
   "alcohol",
   "quality")

head(wineQualityRed)

```

## Descripció de les variables.

1 - fixed acidity: Quantitat d'àcid del vi.

2 - volatile acidity: La quantitat d'àcid acètic que té el vi.

3 - citric acid: La quantitat d'àcid cítric que té el vi.

4 - residual sugar: La quantitat del sucre que resta després de la fermentació.

5 - chlorides: La quantitat de sal.

6 - free sulfur dioxide: La quantitat "lliure" de SO2.

7 - total sulfur dioxide: La quantitat total de SO2.

8 - density: La densitat del líquid

9 - pH: Grau d'acidessa.

10 - sulphates: La qantitat de sulfats que té el vi.

11 - alcohol: EL percentatge d'alcohol que conté el vi.

12 - quality: La variable output, la puntuació del vi.



# 2. Integració i selecció de les dades.

En aquest cas no veiem necessari eliminar ningun atribut, hi ha uns de més importants d'altres, però amb 11 atributs no voldriem eliminar-ne cap.

## Tipus de les variables.

```{r} 
library(knitr)
library(kableExtra)
res <- sapply(wineQualityRed,class)
kable(data.frame(variables=names(res),clase=as.vector(res)))
```

Veiem que totes les variables són de tipus numeric, excepte l'última que és classe integrer.

Deixarem l'últim atribut com a enter, ja que aquest és un número del zero al deu i és la classe output, la que es vol predir.


# 3. Neteja de les dades.

Comprovem l'estructura del joc de dades

```{r }
str(wineQualityRed)
```

Mirem un resum per fer un cop d'ull quins valors tenim
```{r }
summary(wineQualityRed)
```
Amb un summary podem veure més o menys com són les dades per fer-nos una primera idea.


## 3.1 Identificació de valors nul·ls.

Mirarem si hi ha zeros i nul·ls
```{r }
colSums(is.na(wineQualityRed))
colSums(wineQualityRed=="")

```
No hi ha valors a 0 ni nulls. No semba que hi hagi valors perduts (ni N/A ni altres valors). 


## 3.2 Identificació de valors extrems (outliers).

Utilitzant boxplot comprovarem si les variables tenen valors extrems i si aquests valors poden ser considerats vàlids i per tant s'han de tenir en compte o si al contrari són valors invàlids i s'han de tractar o eliminar. 

```{r }
par(mfrow=c(2,2))
boxplot(wineQualityRed$fixedacidity,xlab="fixedacidity")
boxplot(wineQualityRed$volatileacidity,xlab="volatileacidity") 
boxplot(wineQualityRed$citricacid, xlab="citricacid")
boxplot(wineQualityRed$residualsugar,xlab="residualsugar")
boxplot(wineQualityRed$chlorides, xlab="chlorides")
boxplot(wineQualityRed$freesulfurdioxide, xlab ="freesulfurdioxide")
boxplot(wineQualityRed$totalsulfurdioxide,xlab ="totalsulfurdioxide" )
boxplot(wineQualityRed$density, xlab ="density")
boxplot(wineQualityRed$pH, xlab ="pH")
boxplot(wineQualityRed$sulphates, xlab ="sulphates")
boxplot(wineQualityRed$alcohol,xlab="alcohol")
boxplot(wineQualityRed$quality, xlab ="quality")

```

Citricacid té només un valor que està allunyat de la resta. Mirem quin és:
```{r }

boxplot(wineQualityRed$citricacid, plot =FALSE)$out

```
Amb un summary podrem veure quins són els valors i quin és valor màxim per veure si realment està tan allunyat i és un valor no vàlid.

```{r }
summary(wineQualityRed$citricacid)
plot(wineQualityRed$citricacid)
```

El valor que semblaria outiler és 1, el rang de la variable oscil.la entre 0 i 1, i hi ha valors de 0,8 així que no sembla pas un error. El deixarem tal com està.

Comprovarem totalsulfurdioxide perquè també sembla qeu tingui alguns valors allunyats:

```{r }
boxplot(wineQualityRed$totalsulfurdioxide, plot =FALSE)$out
summary(wineQualityRed$totalsulfurdioxide)
plot(wineQualityRed$totalsulfurdioxide)
```

Aquests dos valors si que es veuen ben diferenciats de la resta. Mirem quina informació dóna la seva fila per veure si discernim si són valors correctes o incorrectes.
El valor màxim és 289:
```{r }

wineQualityRed[wineQualityRed$totalsulfurdioxide==289,]
wineQualityRed[wineQualityRed$totalsulfurdioxide==278,]

```

Els valors de totes les variables semblen normals per tant suposarem que els valors d'aquesta variable són correctes. Tal com comenta a:https://archive.ics.uci.edu/ml/datasets/wine+quality els algoritmes d'outliers poden ajudar a detectar els vins excelents o molt pobres i de fet es pot veure que aquests dos valors tenen qualitat = 7 que és alta. Veurem més endavant si aquesta variable té un pes important en la qualitat dels vins.

La resta de variables no sembla que presentin outliers. Hi ha alguns valors fora de la normalitat però no s'en veu cap sol i molt allunyat de tota la resta.

# 4. Anàlisi de les dades.

## 4.1. Selecció dels grups de dades que es volen analitzar/comparar.

Podem comprovar primerament la variable qualitat, que seria la variable que es voldria predir, la variable que ens mostra si un vi és o no és bo.

```{r }
summary(wineQualityRed$quality)
```


Veiem que la majoria dels vins són aprovats, la mitjana és 5.636 i la mediana 6.
Serà més fàcil veure-ho amb representacions visuals.


```{r }
table(wineQualityRed$quality)
```

```{r }
hist(wineQualityRed$quality, 
     main="Histogram for quality", 
     xlab="quality", 
     col="chocolate",
     breaks=seq(min(wineQualityRed$quality)-0.5, max(wineQualityRed$quality)+0.5))
```


Ja que agafem totes les variables, estaria bé analitzar-les totes. 

```{r }
hist(wineQualityRed[[1]], 
     main=colnames(wineQualityRed)[1], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[2]], 
     main=colnames(wineQualityRed)[2], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[3]], 
     main=colnames(wineQualityRed)[3], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[4]], 
     main=colnames(wineQualityRed)[4], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[5]], 
     main=colnames(wineQualityRed)[5], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[6]], 
     main=colnames(wineQualityRed)[6], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[7]], 
     main=colnames(wineQualityRed)[7], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[8]], 
     main=colnames(wineQualityRed)[8], 
     col="chocolate")
```


```{r }
hist(wineQualityRed[[9]], 
     main=colnames(wineQualityRed)[9], 
     col="chocolate")
```

```{r }
hist(wineQualityRed[[10]], 
     main=colnames(wineQualityRed)[10], 
     col="chocolate")
```


```{r }
hist(wineQualityRed[[11]], 
     main=colnames(wineQualityRed)[11], 
     col="chocolate")
```


## 4.2. Comprovació de la normalitat i homogeneïtat de la variància.


```{r }
library(ggpubr)

ggqqplot(wineQualityRed[[1]], title = colnames(wineQualityRed)[1])
ggqqplot(wineQualityRed[[2]], title = colnames(wineQualityRed)[2])
ggqqplot(wineQualityRed[[3]], title = colnames(wineQualityRed)[3])
ggqqplot(wineQualityRed[[4]], title = colnames(wineQualityRed)[4])
ggqqplot(wineQualityRed[[5]], title = colnames(wineQualityRed)[5])
ggqqplot(wineQualityRed[[6]], title = colnames(wineQualityRed)[6])
ggqqplot(wineQualityRed[[7]], title = colnames(wineQualityRed)[7])
ggqqplot(wineQualityRed[[8]], title = colnames(wineQualityRed)[8])
ggqqplot(wineQualityRed[[9]], title = colnames(wineQualityRed)[9])
ggqqplot(wineQualityRed[[10]], title = colnames(wineQualityRed)[10])
ggqqplot(wineQualityRed[[11]], title = colnames(wineQualityRed)[11])
ggqqplot(wineQualityRed[[12]], title = colnames(wineQualityRed)[12])

```

Tot i que la majoria de variables intenten seguir la línea recta, els punts no són dins de la zona grisa. Això vol dir que les variables no segueixen la normalitat.

Si mirem el test de shapiro per extreure'n la p-value:

```{r }
shapiro.test(wineQualityRed[[1]])
shapiro.test(wineQualityRed[[2]])
shapiro.test(wineQualityRed[[3]])
shapiro.test(wineQualityRed[[4]])
shapiro.test(wineQualityRed[[5]])
shapiro.test(wineQualityRed[[6]])
shapiro.test(wineQualityRed[[7]])
shapiro.test(wineQualityRed[[8]])
shapiro.test(wineQualityRed[[9]])
shapiro.test(wineQualityRed[[10]])
shapiro.test(wineQualityRed[[11]])
shapiro.test(wineQualityRed[[12]])
```

Cridant al shapiro test, també veiem que la p-value és més baixa del 5% de grau de confiança (0.05). Tornem a concluir que ninguna variable segueix una normalitat estricta.

## 4.3. Aplicació de proves estadístiques per comparar els grups de dades.

### Regressió lineal simple.

Começarem per aplicar una regressió lineal per veure la relació entre dues variables, podem començar per les variables quality i alcohol.

```{r }
library(ggpubr)
theme_set(theme_pubr())

ggplot(wineQualityRed, aes(x = quality, y = alcohol)) + geom_point() + stat_smooth(method = lm)
```

Els punts s'allunyen molt de la línea recta, aquesta regressió no és bona per una variable entera com la qualitat respecte una double en un rang determinat.


```{r }
mod<-lm(quality ~ alcohol, wineQualityRed)
summary(mod)
```

La R^2 és molt alta, amb això veiem que és molt alte, per tant les dues variables no tenen massa relació.


Si probem amb comparant altres variables:

```{r }
ggplot(wineQualityRed, aes(x = pH, y = alcohol)) + geom_point() + stat_smooth(method = lm)
```

```{r }
ggplot(wineQualityRed, aes(x = sulphates, y = alcohol)) + geom_point() + stat_smooth(method = lm)
```

Veiem que no tenen massa relació entre elles, almenys fent regressions lineals.

### Regressió lineal múltiple.

Si probem amb una regressió lineal múltiple, amb la variable quality més alcohol i pH:

```{r }
mod <- lm(quality ~ alcohol + pH, data = wineQualityRed)

summary(mod)
```

Veiem que tampoc existeix massa relació.

### Regressió logística?.

# 5. Representació dels resultats a partir de taules i gràfiques.



# MirAR normalitat i variança
# BUsCAR CORRELACIONS
# Agafem els vins blancs i fem dos grups???????
# Anàlisis PCA?
# Regressió lineal
# Arbre de decisió?? (discretitzar quality) o kmeans?
